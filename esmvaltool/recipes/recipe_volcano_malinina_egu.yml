# ESMValTool
# recipe_icc_wg1_ar6_fgd_volc_xcb.yml
---
documentation:
  description: Figure for volcano cross-chapter box for Ch. 4 IPCC AR6 report.

  authors:
    - malinina_elizaveta

preprocessors:

  preproc_gsat:
    custom_order: true
    area_statistics:
      operator: mean
    annual_statistics:
      operator: mean
    anomalies:
      period: 'full'
      reference:
        start_year: 1878
        start_month: 1
        start_day: 1
        end_year: 1882
        end_month: 12
        end_day: 31

  preproc_sia:
    custom_order: true
    regrid:
      target_grid: 1x1
      scheme: nearest
    extract_region:
      start_latitude: 50.
      end_latitude: 90.
      start_longitude: 0.
      end_longitude: 360.

  preproc_nino34:
    custom_order: true
    regrid:
      target_grid: 1x1
      scheme: linear
    extract_region:
      start_latitude: -5.
      end_latitude: 5.
      start_longitude: 190.
      end_longitude: 240.

  preproc_se_pr:
    custom_order: true
    mask_inside_range:
      minimum: 0
      maximum: 1.1574074074074073e-05
    annual_statistics:
      operator: sum
    area_statistics:
      operator: sum

  preproc_txx:
    annual_statistics:
      operator: max

models_hist: &models_hist
  - { dataset: ACCESS-ESM1-5, grid: gn, ensemble: "r(1:6)i1p1f1" }
  - { dataset: ACCESS-CM2, institute: CSIRO-ARCCSS, grid: gn, ensemble: "r(1:3)i1p1f1" }
  - {dataset: AWI-ESM-1-1-LR, grid: gn, ensemble: r1i1p1f1}
  - {dataset: BCC-CSM2-MR, grid: gn, ensemble: "r(2:3)i1p1f1"}
  - {dataset: BCC-ESM1, grid: gn, ensemble: "r(1:3)i1p1f1"}
  - {dataset: CAMS-CSM1-0, grid: gn, ensemble: r2i1p1f1}
  - { dataset: CanESM5, grid: gn, ensemble: "r(1:15)i1p1f1" }
  - { dataset: CanESM5, grid: gn, ensemble: "r(1:15)i1p2f1" }
  - { dataset: CMCC-CM2-SR5, grid: gn, ensemble: r1i1p1f1 }
  - { dataset: CMCC-ESM2, grid: gn, ensemble: r1i1p1f1 }
#  - { dataset: HadGEM3-GC31-LL, grid: gn, ensemble: "r(1:4)i1p1f3" }
  - { dataset: HadGEM3-GC31-LL, grid: gn, ensemble: r1i1p1f3 }
  - { dataset: HadGEM3-GC31-LL, grid: gn, ensemble: "r(3:4)i1p1f3" }
  - { dataset: HadGEM3-GC31-MM, grid: gn, ensemble: "r(1:4)i1p1f3" }
  - {dataset: INM-CM4-8, grid: gr1, ensemble: r1i1p1f1}
  - {dataset: INM-CM5-0, grid: gr1, ensemble: "r(1:10)i1p1f1"}
  - {dataset: KIOST-ESM, grid: gr1, ensemble: r1i1p1f1}
  - {dataset: MIROC6, grid: gn, ensemble: "r(1:10)i1p1f1"}
  - {dataset: MIROC-ES2L, grid: gn, ensemble: "r(1:10)i1p1f2"}
  - { dataset: MPI-ESM-1-2-HAM, grid: gn, ensemble: "r(1:3)i1p1f1" }
  - {dataset: MPI-ESM1-2-HR, grid: gn, ensemble: "r(1:10)i1p1f1"}
  - {dataset: MPI-ESM1-2-LR, grid: gn, ensemble: "r(1:10)i1p1f1"}
  - {dataset: MRI-ESM2-0, grid: gn, ensemble: "r(1:5)i1p1f1"}
  - { dataset: NESM3, grid: gn, ensemble: "r(1:5)i1p1f1" }
#  - {dataset: NorCPM1, grid: gn, ensemble: "r(1:10)i1p1f1"}
  - {dataset: NorESM2-LM, grid: gn, ensemble: "r(1:3)i1p1f1"}
  - {dataset: NorESM2-MM, grid: gn, ensemble: "r(1:3)i1p1f1"}
  - {dataset: SAM0-UNICON, grid: gn, ensemble: r1i1p1f1}
  - { dataset: TaiESM1, grid: gn, ensemble: r1i1p1f1 }
  - { dataset: UKESM1-0-LL, grid: gn, ensemble: "r(1:4)i1p1f2" }

models_nat: &models_nat
  - { dataset: ACCESS-ESM1-5, grid: gn, ensemble: r1i1p1f1 }
  - { dataset: ACCESS-ESM1-5, grid: gn, ensemble: r3i1p1f1 }
  - { dataset: ACCESS-ESM1-5, grid: gn, ensemble: r5i1p1f1 }
  - {dataset: BCC-CSM2-MR, grid: gn, ensemble: "r(1:3)i1p1f1"}
  - { dataset: CanESM5, grid: gn, ensemble: "r(1:10)i1p1f1" }
  - { dataset: HadGEM3-GC31-LL, grid: gn, ensemble: "r(1:4)i1p1f3" }
  - {dataset: MIROC6, grid: gn, ensemble: "r(1:50)i1p1f1"}
  - {dataset: MRI-ESM2-0, grid: gn, ensemble: "r(1:5)i1p1f1"}

diagnostics:
  xcbox_vol:
    description: Figure for volcanic cross-chapter box Chapter 4 IPCC AR6 report
    variables:
      tas:
        mip: Amon
        project: CMIP6
        exp: historical
        start_year: 1878
        end_year: 1893
        preprocessor: preproc_gsat
        additional_datasets: *models_hist
      siconc:
        mip: SImon
        project: CMIP6
        exp: historical
        start_year: 1878
        end_year: 1893
        preprocessor: preproc_sia
        additional_datasets: *models_hist
      tos:
        mip: Omon
        project: CMIP6
        exp: historical
        start_year: 1868
        end_year: 1897
        preprocessor: preproc_nino34
        additional_datasets: *models_hist
      pr:
        mip: day
        project: CMIP6
        exp: historical
        start_year: 1881
        end_year: 1893
        preprocessor: preproc_se_pr
        additional_datasets: *models_hist
      tasmax:
        mip: day
        project: CMIP6
        exp: historical
        start_year: 1881
        end_year: 1893
        preprocessor: preproc_txx
        additional_datasets: *models_hist

    scripts:
      xcbox_volc:
        script: volcanic_response/diagnostic_volcanic_xcb.py 
        mpl_style: ipcc_ar6_fgd
        volcano_name: 'Krakatoa'
        eruption_date: '1883-08-27'
        plot_start_year: 1881
        plot_end_year: 1893
        anomaly_period : [1878, 1882]
